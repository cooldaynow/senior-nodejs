# Garbage Collector –≤ V8

## 1. –¢–∏–ø—ã GC –≤ V8

V8 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é.

### 1.1. Mark-and-Sweep (–ü–æ–º–µ—Ç–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

1. –ü–æ–º–µ—á–∞—é—Ç—Å—è **–≤—Å–µ –¥–æ—Å—Ç–∏–∂–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã**.
2. GC —É–¥–∞–ª—è–µ—Ç **–æ–±—ä–µ–∫—Ç—ã –±–µ–∑ —Å—Å—ã–ª–æ–∫**.
3. –û—á–∏—â–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**.

‚úÖ **–ü–ª—é—Å—ã:**

- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–∏—Å—Ç–∫–∏.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ "–°—Ç–æ–ø-–º–∏—Ä" –ø–∞—É–∑–∞–º.

---

### 1.2. Incremental GC (–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π GC)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –†–∞–∑–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å Mark-and-Sweep –Ω–∞ **–Ω–µ–±–æ–ª—å—à–∏–µ —á–∞—Å—Ç–∏**.
- –†–∞–±–æ—Ç–∞–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è "–°—Ç–æ–ø-–º–∏—Ä" –ø–∞—É–∑—ã.

‚úÖ **–ü–ª—é—Å—ã:**

- –°–Ω–∏–∂–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –±–æ–ª—å—à–µ CPU.

---

### 1.3. Generational GC (–ü–æ–∫–æ–ª–µ–Ω—á–µ—Å–∫–∏–π GC)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –†–∞–∑–¥–µ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –Ω–∞ **–º–æ–ª–æ–¥–æ–µ –∏ —Å—Ç–∞—Ä–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ**.
- **–ú–æ–ª–æ–¥—ã–µ –æ–±—ä–µ–∫—Ç—ã** –æ—á–∏—â–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, **—Å—Ç–∞—Ä—ã–µ ‚Äî —Ä–µ–∂–µ**.

‚úÖ **–ü–ª—é—Å—ã:**

- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —á–∞—Å—Ç—ã–µ —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–æ–∫–æ–ª–µ–Ω–∏—è–º–∏ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤.

---

### 1.4. Concurrent GC (–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π GC)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º JavaScript-–∫–æ–¥–∞**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å**, —Å–Ω–∏–∂–∞—è "–°—Ç–æ–ø-–º–∏—Ä" –ø–∞—É–∑—ã.

‚úÖ **–ü–ª—é—Å—ã:**

- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ GC.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –°–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.

---

## 2. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–±–æ—Ç—ã GC –≤ V8

V8 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤. –°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã GC:

### 2.1. Minor GC (Scavenge GC, Young Generation GC)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –û—á–∏—â–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –º–æ–ª–æ–¥–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ (New Space)**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–∫–æ–ø–∏—Ä—É—é—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (Semi-space GC)** ‚Üí –æ–±—ä–µ–∫—Ç—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –º–µ–∂–¥—É `from-space` –∏ `to-space`.
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–æ—á–µ–Ω—å —á–∞—Å—Ç–æ**, –∑–∞–Ω–∏–º–∞–µ—Ç **< 1 –º—Å**.

‚úÖ **–ü–ª—é—Å—ã:**

- –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞.
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ù–µ —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ —Å—Ç–∞—Ä–æ–º –ø–æ–∫–æ–ª–µ–Ω–∏–∏.

---

### 2.2. Major GC (Old Generation GC, Mark-and-Sweep GC)

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –û—á–∏—â–∞–µ—Ç **—Å—Ç–∞—Ä–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ (Old Space)**.
- –í–∫–ª—é—á–∞–µ—Ç **–ø–æ–ª–Ω—ã–π –æ–±—Ö–æ–¥ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏**.
- **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥**, –µ—Å–ª–∏ –ø–∞–º—è—Ç—å –±—ã—Å—Ç—Ä–æ —Ä–∞—Å—Ç—ë—Ç.

‚úÖ **–ü–ª—é—Å—ã:**

- –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã.
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö –∑–æ–Ω–∞—Ö –ø–∞–º—è—Ç–∏.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –í—ã–∑—ã–≤–∞–µ—Ç "–°—Ç–æ–ø-–º–∏—Ä" –ø–∞—É–∑—É, –∑–∞–º–µ–¥–ª—è—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞.
- –ù–µ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –ø–∞–º—è—Ç—å (–º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è).

---

### 2.3. Idle GC

üìå **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–≤ —Ñ–æ–Ω–µ**, –∫–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω.
- –ú–æ–∂–µ—Ç **—Ä–∞–∑–±–∏–≤–∞—Ç—å Major GC –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–∑**, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –ª–∞–≥–∏.
- –í –±—Ä–∞—É–∑–µ—Ä–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ **–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞**.

‚úÖ **–ü–ª—é—Å—ã:**

- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç "–°—Ç–æ–ø-–º–∏—Ä" –∑–∞–¥–µ—Ä–∂–∫–∏.
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ —Ñ–æ–Ω–µ.

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ú–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–∞–≥—Ä—É–∂–µ–Ω.

---

## 3. "–°—Ç–æ–ø-–º–∏—Ä" (Stop-the-world) —Ñ–∞–∑—ã

**–°—Ç–æ–ø-–º–∏—Ä** ‚Äì —ç—Ç–æ –ø–∞—É–∑–∞ –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞, –∫–æ–≥–¥–∞ GC –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ JavaScript –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏.

### 3.1. –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å "–°—Ç–æ–ø-–º–∏—Ä" –ø–∞—É–∑?

‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**.

‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ –æ–±—ä–µ–∫—Ç–∞–º–∏**.

‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**.

‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**.
‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å **—Ä–∞–±–æ—Ç—É —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ –æ–±—ä–µ–∫—Ç–∞–º–∏**.
‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å **—É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**.

---

## 4. –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ Node.js –∏ –∏—Ö –≤—ã—è–≤–ª–µ–Ω–∏–µ

–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ ‚Äî —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –ø–∞–º—è—Ç—å **–Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è**, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

### 4.1. –ü—Ä–∏–∑–Ω–∞–∫–∏ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

- **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–æ—Å—Ç heapUsed –≤ `process.memoryUsage()`**.
- **RSS (Resident Set Size) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –±–µ–∑ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏**.
- **GC –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞**.

### 4.2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ç–µ—á–µ–∫

üìå **Heap Snapshot –≤ Chrome DevTools**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥ —Å `node --inspect memory-leak.js`.
2. –û—Ç–∫—Ä—ã—Ç—å `chrome://inspect` ‚Üí `Open dedicated DevTools for Node`.
3. –ü–µ—Ä–µ–π—Ç–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É **Memory ‚Üí Heap Snapshot**.
4. –°–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–Ω–∏–º–∫–æ–≤ –ø–∞–º—è—Ç–∏ –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –∏—Ö.

## 5. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å —É—Ç–µ—á–∫–æ–π –ø–∞–º—è—Ç–∏

üìå **–§–∞–π–ª:** [`memory-leak.js`](./memory-leak.js)

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏?

```sh
node --inspect memory-leak.js
```

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ `chrome://inspect` –∏ –æ—Ç–∫—Ä—ã—Ç—å DevTools.
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤–æ –≤–∫–ª–∞–¥–∫—É **Memory ‚Üí Allocation Timelines**.
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ **—Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–æ—Å—Ç–æ–º –ø–∞–º—è—Ç–∏**.

üìå **–ï—Å–ª–∏ –ø–∞–º—è—Ç—å —Ä–∞—Å—Ç—ë—Ç –ª–∏–Ω–µ–π–Ω–æ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ ‚Äì —ç—Ç–æ —É—Ç–µ—á–∫–∞.**

---

## –ò—Ç–æ–≥

‚úî **V8 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ GC: Mark-and-Sweep, Incremental, Generational, Concurrent.**

‚úî **–°—Ç–æ–ø-–º–∏—Ä —Ñ–∞–∑—ã ‚Äî –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ª–∞–≥–æ–≤, –Ω–æ –∏—Ö –º–æ–∂–Ω–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.**

‚úî **Heap Snapshots –∏ heapdump –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞–π—Ç–∏ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏.**

‚úî **–ü—Ä–∏–º–µ—Ä `memory-leak.js` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ JS.**
