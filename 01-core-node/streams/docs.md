# üî• –ü–æ—Ç–æ–∫–∏ (Streams) –≤ Node.js

üí° **–ü–æ—Ç–æ–∫–∏ (Streams) ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ –æ–±—ä—ë–º–∞ –≤ –ø–∞–º—è—Ç—å. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —á–∏—Ç–∞—Ç—å, –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —á–∞—Å—Ç—è–º, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—è —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–æ—Ç–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.**

---

## üìå 1. –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –ø–æ—Ç–æ–∫–∏?

**‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏** ‚Äì –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **—Ñ–∞–π–ª—ã –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞**, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ RAM.
- **–ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äì –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö **–¥–æ –∏—Ö –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**.
- **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äì –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ –¥–ª—è —Å–∂–∞—Ç–∏—è, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏.

**üìç –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Ç–æ–∫–∏?**

‚úî **–ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ (`fs.createReadStream`, `fs.createWriteStream`)**  
‚úî **HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã (`req`, `res`)**  
‚úî **TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (`net.createServer()`)**  
‚úî **WebSockets, SSE, API-—Å—Ç—Ä–∏–º–∏–Ω–≥**  
‚úî **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –¥–∞–Ω–Ω—ã—Ö (Transform Stream)**

---

## üìå 2. –¢–∏–ø—ã –ø–æ—Ç–æ–∫–æ–≤ –≤ Node.js

| –¢–∏–ø –ø–æ—Ç–æ–∫–∞                       | –û–ø–∏—Å–∞–Ω–∏–µ                           | –ü—Ä–∏–º–µ—Ä                              |
| -------------------------------- | ---------------------------------- | ----------------------------------- |
| **Readable** (—á–∏—Ç–∞–µ–º—ã–π)          | –ü–æ—Ç–æ–∫ **—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** | `fs.createReadStream('file.txt')`   |
| **Writable** (–∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π)      | –ü–æ—Ç–æ–∫ **—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö** | `fs.createWriteStream('file.txt')`  |
| **Duplex** (–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)     | **–ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ** | `net.Socket`, `TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è`      |
| **Transform** (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–π) | **–ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–µ—Ç—É**        | `zlib.createGzip()`, **—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** |

---

## üìå 3. –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏

### üìç –ß–∏—Ç–∞–µ–º—ã–π –ø–æ—Ç–æ–∫ (`Readable Stream`)

```js
const fs = require('fs');
const readStream = fs.createReadStream('bigfile.txt', 'utf8');

readStream.on('data', (chunk) => {
  console.log('üì• –ü–æ–ª—É—á–µ–Ω —á–∞–Ω–∫:', chunk.length, '–±–∞–π—Ç');
});

readStream.on('end', () => {
  console.log('‚úÖ –§–∞–π–ª –ø—Ä–æ—á–∏—Ç–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é');
});
```

üí° **–ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –ø–æ –∫—É—Å–∫–∞–º, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è –µ–≥–æ –≤ –ø–∞–º—è—Ç—å —Ü–µ–ª–∏–∫–æ–º.**

---

### üìç –ó–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π –ø–æ—Ç–æ–∫ (`Writable Stream`)

```js
const fs = require('fs');
const writeStream = fs.createWriteStream('output.txt');

writeStream.write('–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n');
writeStream.write('–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n');

writeStream.end(() => console.log('‚úÖ –§–∞–π–ª –∑–∞–ø–∏—Å–∞–Ω'));
```

üí° **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —á–∞—Å—Ç—è–º –≤ —Ñ–∞–π–ª, —É–ø—Ä–∞–≤–ª—è—è –ø–æ—Ç–æ–∫–æ–º –≤—Ä—É—á–Ω—É—é.**

---

### üìç Pipe: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```js
const fs = require('fs');

const readStream = fs.createReadStream('input.txt');
const writeStream = fs.createWriteStream('output.txt');

readStream.pipe(writeStream);
```

üí° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `readStream` –≤ `writeStream` –±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏.**

---

## üìå 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Backpressure (–¥–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ—Ç–æ–∫–∞)

**Backpressure** ‚Äì —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ **–ø–æ—Ç–æ–∫ —á—Ç–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π, –∞ –ø–æ—Ç–æ–∫ –∑–∞–ø–∏—Å–∏ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**.

### üìç –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `pause()` –∏ `resume()`

```js
const fs = require('fs');
const readStream = fs.createReadStream('bigfile.txt');
const writeStream = fs.createWriteStream('output.txt');

readStream.on('data', (chunk) => {
  const canWrite = writeStream.write(chunk);

  if (!canWrite) {
    console.log('‚è∏ –ë—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω, –ø–∞—É–∑–∞');
    readStream.pause();
    writeStream.once('drain', () => {
      console.log('üîÑ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º');
      readStream.resume();
    });
  }
});
```

üí° **–¢–µ–ø–µ—Ä—å –ø–æ—Ç–æ–∫ —á—Ç–µ–Ω–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.**

---

## üìå 5. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–π –ø–æ—Ç–æ–∫ (`Transform Stream`)

–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ –∏–∑–º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ **"–Ω–∞ –ª–µ—Ç—É"**. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ **—à–∏—Ñ—Ä–æ–≤–∞—Ç—å** –∏–ª–∏ **—Å–∂–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**.

### **üìç –ü—Ä–∏–º–µ—Ä: –ø–æ—Ç–æ–∫–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**

```js
const { Transform } = require('stream');

class UpperCaseTransform extends Transform {
  _transform(chunk, encoding, callback) {
    this.push(chunk.toString().toUpperCase());
    callback();
  }
}

const upperCaseTransform = new UpperCaseTransform();
process.stdin.pipe(upperCaseTransform).pipe(process.stdout);
```

üí° **–ë–µ—Ä—ë—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–µ–ª–∞–µ—Ç –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –∏ –≤—ã–≤–æ–¥–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ.**

---

## üìå 6. SSE (Server-Sent Events) ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ WebSockets

SSE ‚Äî —ç—Ç–æ **–ø–æ—Ç–æ–∫–æ–≤—ã–π HTTP-–æ—Ç–≤–µ—Ç**, –∫–æ—Ç–æ—Ä—ã–π **—Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç**.

### **üìç –ü—Ä–∏–º–µ—Ä: SSE-—Å–µ—Ä–≤–µ—Ä**

```js
const http = require('http');

const clients = [];

const server = http.createServer((req, res) => {
  if (req.url === '/events') {
    res.writeHead(200, {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      Connection: 'keep-alive',
    });

    clients.push(res);

    req.on('close', () => {
      clients.splice(clients.indexOf(res), 1);
    });
  }
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
const sendNotification = (message) => {
  clients.forEach((client) => client.write(`data: ${message}\n\n`));
};

setInterval(() => {
  sendNotification(`üîî –ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${new Date().toISOString()}`);
}, 5000);

server.listen(3000, () => console.log('üöÄ SSE-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ 3000'));
```

üí° **–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑ WebSockets, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ—Ç–æ–∫–æ–≤—ã–π HTTP.**

---

## üìå 7. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –∏ WebSockets

–ú–æ–∂–Ω–æ **–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫–∏, SSE –∏ WebSockets** –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å real-time API.

- **HTTP –¥–ª—è CRUD (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∫—É–ø–∫–∏).**
- **WebSockets –¥–ª—è real-time —á–∞—Ç–æ–≤.**
- **SSE –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.**
- **Streams –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤.**

## üìå 8. –ü—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ [server.ts](./server.ts) —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–∞ –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –≤—ã–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö

üí° **–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã:**

‚úî –ü—Ä–∏–Ω–∏–º–∞–µ–º **–∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞** —á–µ—Ä–µ–∑ `POST /upload` **–ø–æ—Ç–æ–∫–∞–º–∏**.  
‚úî –û—Ç–¥–∞—ë–º **–¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –ø–æ—Ç–æ–∫–æ–º** —á–µ—Ä–µ–∑ `GET /stream`.

---

### üìå –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å?

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞**

```sh
 node -e "console.log(JSON.stringify(Array.from({ length: 1_000_000 }, (_, i) => ({ id: i, name: 'User' + i, age: 20 + (i % 50), city: 'City' + (i % 100) })), null, 2))" > big.json
```

**–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ `curl`**

```sh
curl -X POST -F "file=@bigfile.txt" http://localhost:3000/upload
```

üí° –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø–æ—Ç–æ–∫–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `/streams`.

**–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ—Ç–æ–∫–æ–º**

```sh
curl -O http://localhost:3000/download/big.json
```

üí° –§–∞–π–ª **–æ—Ç–¥–∞—ë—Ç—Å—è –ø–æ—Ç–æ–∫–æ–º**, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ø–∞–º—è—Ç—å.
