# Worker Threads –≤ Node.js

## 1. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ Node.js –∏ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Thread Pool libuv

–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ä–µ–¥–µ Node.js –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ **–æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ** (single-threaded), –Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è **Worker Threads** –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å **–Ω–∞—Å—Ç–æ—è—â–∏–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**.

### **Thread Pool –≤ libuv**

`worker_threads` –ø–æ—è–≤–∏–ª–∏—Å—å –≤ Node.js –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ **Thread Pool –≤ libuv**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫:

- –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ (`fs`)
- –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`crypto`)
- DNS-–∑–∞–ø—Ä–æ—Å—ã (`dns.lookup`)
- –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö (`zlib`)

Thread Pool ‚Äî —ç—Ç–æ **–ø—É–ª –ø–æ—Ç–æ–∫–æ–≤**, –≤ –∫–æ—Ç–æ—Ä–æ–º Node.js —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∞–º–∏, **–Ω–æ –∫–æ–¥ –Ω–∞ JavaScript –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ**. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–∑–æ–≤—ã `fs.readFile` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ—Ç–æ–∫ –∏–∑ **Thread Pool**, –Ω–æ —Å–∞–º JavaScript –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ.

### Worker Threads: –Ω–∞—Å—Ç–æ—è—â–∞—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Thread Pool, **Worker Threads —Å–æ–∑–¥–∞—é—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –û–°**, –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫:

- **–ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–≤–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ V8**
- **–ò—Å–ø–æ–ª–Ω—è–µ—Ç JavaScript –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≥–ª–∞–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞**
- **–°–æ–∑–¥–∞—ë—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä libuv —Å–æ —Å–≤–æ–∏–º Thread Pool –∏ Event Loop**

![–°—Ö–µ–º–∞ Worker Threads](./1.jpg)

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç `worker_threads` **–Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–º–∏** –¥–ª—è **CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ —Ç.–¥.).

---

## 2. –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É Worker‚Äô–∞–º–∏

Worker Threads –º–æ–≥—É—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑:

- `postMessage()` ‚Äì –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã—Ö, –∫–∞–∫ JSON)
- `SharedArrayBuffer` ‚Äì –æ–±—â–∏–π –±—É—Ñ–µ—Ä –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- `MessageChannel` ‚Äì –∫–∞–Ω–∞–ª –¥–ª—è –¥–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –æ–±—â–µ–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö

#### –í –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ (`main.ts`):

```typescript
const worker = new Worker('./worker.js');
worker.postMessage('–ü—Ä–∏–≤–µ—Ç, Worker!');
worker.on('message', (msg) => {
  console.log('–û—Ç–≤–µ—Ç –æ—Ç Worker:', msg);
});
```

#### –í Worker (`worker.js`):

```typescript
const { parentPort } = require('worker_threads');
parentPort.on('message', (data) => {
  console.log('Worker –ø–æ–ª—É—á–∏–ª:', data);
  parentPort.postMessage('–ü—Ä–∏–≤–µ—Ç, –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫!');
});
```

---

## 3. –ü—Ä–∏–º–µ—Ä –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞

üìå **–ü—Ä–∏–º–µ—Ä –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞:**
[–°–º–æ—Ç—Ä–µ—Ç—å `main.ts`](./main.ts)

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ß–∏—Å–ª–æ **—Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏ (chunk'–∏)**
- –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ Worker‚Äô–æ–≤**, –∫–∞–∂–¥—ã–π —Å—á–∏—Ç–∞–µ—Ç —Å–≤–æ–π –∫—É—Å–æ–∫
- –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è **–≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π Worker**, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–º–Ω–æ–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
‚îú‚îÄ‚îÄ factorial.ts   # –í–æ—Ä–∫–µ—Ä—ã —Å—á–∏—Ç–∞—é—Ç —á–∞—Å—Ç–∏ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
‚îú‚îÄ‚îÄ helpers.ts     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ main.ts       # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ sum.ts        # –ò—Ç–æ–≥–æ–≤–æ–µ –ø–µ—Ä–µ–º–Ω–æ–∂–µ–Ω–∏–µ
```

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å** —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –º–æ—â–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

---

## –í—ã–≤–æ–¥

- **Thread Pool –≤ libuv** —Ö–æ—Ä–æ—à –¥–ª—è **I/O-–æ–ø–µ—Ä–∞—Ü–∏–π**, –Ω–æ **–Ω–µ —É–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å JavaScript –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö**.
- **Worker Threads** –ø–æ–∑–≤–æ–ª—è—é—Ç **–∏—Å–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –∏–¥–µ–∞–ª—å–Ω—ã–º–∏ –¥–ª—è **CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á**.
- **–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É Worker‚Äô–∞–º–∏** –≤–æ–∑–º–æ–∂–Ω–∞ —á–µ—Ä–µ–∑ `postMessage()`, `SharedArrayBuffer` –∏ `MessageChannel`.
- **–ü—Ä–∏–º–µ—Ä —Å —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–æ–º** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Worker Threads** –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ Node.js.
